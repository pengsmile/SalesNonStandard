### 项目名称：销售非标方案 已更名为 VIP客户

### 线上测试 http://test2.qdental.cn/OANew/VIP/view

### 切换人员地址 http://test2.qdental.cn/OANew/VIP/index

### 项目部署目录 http://test2.qdental.cn/OANewSystem/Template/SalesNonStandard

开发时间为 2020-05-12 起，至 2020-05-22 初步验收已通过
页面功能为 VIP客户查询，VIP新增修改客户、停用，以及VIP新增、修改停用、治疗方案，销售人员新增权限和审核人员的审核权限，还有审核完成，查看相关治疗方案。

-- 此项目配套收费页： VIP收费 目录名称：VipPayment

### 2020-05-22 需要修改的内容 --------- START -----------
# 修改一
列表
1.  客户信息                       2020-05-22 已完成
	姓名
	联系方式
	诊所  : 品牌 + 诊所
	优惠额度
	额度内优惠比例
	超额优惠比例
	结算方式
	创建人	
	创建时间
2.  治疗方案                       2020-05-22 已完成
    姓名
	联系方式
    诊所  : 品牌 + 诊所	
	优惠额度
	额度内优惠比例
	超额优惠比例
	结算方式
    审核状态
    创建人	
	创建时间
列表选项卡 默认定位 在[治疗方案]    2020-05-22 已完成
开始日期 结束日期  默认时间   一周  2020-05-25 已完成
查询按钮放点审核状态边上            2020-05-25 已完成

# 修改二                                        
1.所有折扣百分比的显示,如果显示原数据的小数, 那全是小数
如果要显示 百分数 全显示百分数 ,不再重复说明,如果显示百分数,请在对应说明或label上添加’%’说明
2.所有审核,撤销操作前,需做确认, 通过 或驳回 ,确认文字中,需写明
                                            2020-05-22 已完成
# 修改三
审核/查看页面                                2020-05-22 已完成
1.通过/驳回 与 提交按钮放在同一个位置  ,可以修改对应字体色和样式

方案审核改为 审核说明

2.审核/查看页面 添加 审核历史记录列表          2020-05-22 已完成
放置在诊疗项表格之后
历史记录
```
客户/治疗方案 单条数据
{
  SP_NAME:'SP_VIP_VTP_SELECT'
  VIP_KY  读取客户信息
  VPT_KY  读取治疗方案信息

}

返回字段
m:SELECT
VIP: 数组  字段 参上

VTP:
m : "multi_result",
{
        treatment_plan :{}   治疗方案主表
        treatment_plan_detail:[]    治疗项目
        audit_history : 审核历史
        vip: {}  客人信息
}

audit_history :[{
     CREATE_DATE : 审核时间
      VPTP_STATUS_DESC 审核状态
      WW_USERID_DESC 审核人
   REASON 审核说明
}]
```

3.顺序 修改下 总价 额度内优惠   超额优惠      2020-05-22 已完成

## 优化 2020-05-25 搜索表单内容移至全局共享，搜索表单,无感知动态获取

### ------------ END ---------------


### 2020-05-25 新提出需要修改的内容 --------- START -----------

发现BUG, 选择明细，核对总价时，如优惠比例没有填写，总价为NAN, 【已修复】

比例验证方式
数字框内, 
1. 如果 >0 && < 1   ,真实折扣比 四舍五入后 保留2位小数,
   例如  0.3456  => 真实折扣比: 0.35   ---------------- 当天已完成
显示在文本框 如果以百分比出现的话  => 0.35 * 100   + ‘35’

2. 如果 > 1   输入范围 需在 0 - 100之间,包括 0和100,不允许有小数
   真实折扣比  数字 /100               ---------------- 当天已完成
  例如  35 => 真实折扣比  0.35
   现在数字框上  ‘’35’

提交的时候, 统一以 真实折扣比提交 提交
如果显示的是百分比 ,请在label上注明 “%” 百分比  注！输入框 百分比后面 加入 百分号  ------- 当天已完成

修改页面   ------------------   当天已完成
增加 审核历史

post接口已经返回, 但是”提交中”提示还在  ----------------- 当天已完成
新增/修改   保存后可以留在原页面        ----------------- 当天已完成
审核完成的页面退回到列表页面            ----------------- 当天已完成

审核历史由审核状态变更为 审核、修改     ------------------ 当天已完成




### ------------------- END ---------------------

### 2020-05-26 ------------START --------------

2020-05-26 修改 提交超额优惠比例、额度内优惠比例 大于1 保留两位小数，< 1 不做处理

[已修复]隐形BUG: 由于优惠比例小于 1 不做处理，导致计算金额与服务器不一致，已修复为 小于 1不做 / 100，达到0.5 和50% 一样的效果

审核人员也可查看客户信息，不可修改，新增 超额比例、额度内比例、结算方式、最大额度、已用额度、已付总计 信息

[已修复]已知BUG，点击新增客户，抽屉中的内容并没有置空，已置空

### ------------------- END -------------------

### 2020-06-04 新增VIP审核 ---------- START -------------

VIP就诊审核
1. 验证用户是否有权限审核就诊  
{
   SP_NAME: SP_VIP_AUDIT_AUTH_VERIFY,
   m: INVOKE
}

返回
{
  RETURN_CODE // 为 0 ,可以验证VIP就诊
}

2. 查询 就诊审核结果
{
  SP_NAME : SP_VIP_VISIT_AUDIT_INFO_SELECT
  m: SELECT
  VPVT_KY:
}

返回 查看后台
/***************/
3. 查询 待审核就诊LIST
{
  SP_NAME : SP_VIP_VISIT_AUDIT_INFO_LIST
  m: LIST
  VPVT_KY:
}

返回 查看后台
/***************/
4. 执行审核操作
{
  SP_NAME : SP_VIP_VISIT_AUDIT_INFO_INVOKE
  m: INVOKE
  VPVT_KY:
  ACTION:'NEXT' -> 审核通过
         'REJECT'  -> 驳回
  AUDIT_COMMENT :  审核意见
}

### ------------------- END -------------------

